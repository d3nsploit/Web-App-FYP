{% extends 'base.html' %}

{% block head %}
<title>ScanMe</title>
{% endblock %}



{% block body %}

<div class="popup" id="popup-1" style="color: #000000;">
  <div class="overlay"></div>
  <div class="content">
    <div class="close-btn" onclick="togglePopup()">Ã—</div>
    {% if session%}
    <h3>Report this result</h3>
    <div class="grid-container2">
      <form method="POST" action="{{ url_for('represult') }}">
        <label>URL:</label>
        <input type="text" name="url-rep" value="{{ data0 }}" readonly style="width: 100%; border-color: #000000;border-width: 1.5px;"><br><br>
        <label>Details of report:</label>
        <textarea class="popup-input popup-box" name="detail-rep" placeholder="Details of report"
          required></textarea>
        <input class="popup-btn" type="submit" value="Submit">
      </form>
    </div>
  </div>
  {% else %}
  <h5 style="text-align: center;">This action required you to sign in</h4>
    <form method="GET" action="{{ url_for('signin') }}">
      <input class="popup-btn" type="submit" value="Sign In">
    </form>
  {% endif %}
</div>

<div class="result-page">
  <div>
    <form method="POST" action="{{ url_for('result') }} ">
      <input class="scan-form" name="url" type="text" placeholder="Scan a URL" required />
      <button type="submit" class="btn btn-primary form-icon">
        <i class="fa fa-search"></i>
      </button>
    </form>
  </div>

  <div class="row row-result" id="result-sum-page">

    <!-- left Column -->
    <div class="column left">
      <h4>Screenshot</h4>
      <h2><img id="webImage" src="{{ data2 }}"></h2>
      <p id="myModal" class="modal">
        <!-- The Close Button -->
        <span class="close">&times;</span>
        <!-- Modal Content (The Image) -->
        <img class="modal-content" id="img01">
      </p>
      <br>
      <button onclick="togglePopup()" id="report" class="btn btn-danger btn-size">Report</button>
      <button onclick="downloadPDF()" id="download" class="btn btn-info btn-size">Download</button>
      <form action="{{ url_for('result') }}" method="POST" style="display: inline-block;">
        <button name="url" class="btn btn-warning btn-size" style="color: #ffffff;" value="{{ data0 }}">Rescan</button>
      </form>
    </div>

    <!-- right Column -->
    <div class="column right">
      <h4>Submitted URL</h4>
      <p class="url-link"> {{ data0 }} </p>
      <hr>
      <h4>Submitted On</h4>
      <p class="url-link"> {{ data1 }} </p>
      <hr>
      <h4>Redirects Route</h4>
      {% for x in data11 %}
        <p>{{ x }}</p>
      {% endfor %}

      <hr>
    </div>

    <div class="column left-sum">
      <h4 class="h4-title">Result Summary</h4>
      <div class="grid-container">
        <div>URL Status</div>
        {% if data3 == 'benign'%}
        <div style="color: green;"><b>Secure</b></div>
        {% else %}
        <div style="color: red;"><b>Malicious</b></div>
        {% endif %}

        <div>Main Domain</div>
        <div>{{ data4 }}</div>
        <div>Status Code</div>
        <div>{{ data5 }}</div>
        <div>Content Size</div>
        <div>{{ data6 }} bytes</div>
      </div>
    </div>

    <div class="column right-sum">
      <div class="grid-container">
        <div>IP Address</div>
        <div>{{ data7 }}</div>
        <div>Redirects</div>
        <div>{{ data8 }}</div>
        <div>Date Created</div>
        <div>{{ data9 }}</div>
        <div>Country</div>
        <div>{{ data10 }}</div>
      </div>
    </div>
  </div>



  <script>
    var modal = document.getElementById("myModal");
    var img = document.getElementById("webImage");
    var modalImg = document.getElementById("img01");
    var captionText = document.getElementById("caption");
    img.onclick = function () {
      modal.style.display = "block";
      modalImg.src = this.src;
      captionText.innerHTML = this.alt;
    }

    var span = document.getElementsByClassName("close")[0];
    span.onclick = function () {
      modal.style.display = "none";
    }
  </script>

  <script>
    function downloadPDF() {
      var element = document.getElementById("result-sum-page");
      html2pdf(element, {
        margin: 10,
        filename: 'download.pdf',
        image: {
          type: 'jpg',
          quality: 0.98
        },
        html2canvas: {
          scale: 2,
          logging: true,
          dpi: 192,
          letterRendering: true
        },
        jsPDF: {
          unit: 'mm',
          format: 'a4',
          orientation: 'portrait'
        }
      });
    }
  </script>

  <script>
    function togglePopup() {
      document.getElementById("popup-1").classList.toggle("active");
    }
  </script>

  {% endblock %}