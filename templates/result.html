{% extends 'base.html' %}

{% block head %}
<title>ScanMe</title>
{% endblock %}



{% block body %}

<div class="popup" id="popup-1">
  <div class="overlay"></div>
  <div class="content">
    <div class="close-btn" onclick="togglePopup()">Ã—</div>
    {% if session%}
    <h1>Report this result</h1>
    <div class="grid-container">
      <div>URL</div>
      <div>{{ data0 }}</div>
      <div>Username</div>
      <div>{{ session['fname'] }}</div>
      <div>Details</div>
      <div>
        <form method="POST" action="{{ url_for('result') }}">
          <textarea class="popup-input popup-box" placeholder="Details of report" required></textarea>
          <input class="popup-btn" type="submit" value="Submit">
        </form>
      </div>
    </div>
    {% else %}
    <h4 style="text-align: center;">Please Sign-in</h4>
    {% endif %}
  </div>
</div>

<div class="result-page">
  <div>
    <form method="POST" action="{{ url_for('result') }} ">
      <input class="scan-form" name="url" type="text" placeholder="Scan a URL" required />
      <input class="btn-result" type="submit" value="ScanMe">
    </form>
  </div>

  <div class="row row-result" id="result-sum-page">

    <!-- left Column -->
    <div class="column left">
      <h4>Screenshot</h4>
      <h2><img id="webImage" src="{{ data2 }}"></h2>
      <p id="myModal" class="modal">
        <!-- The Close Button -->
        <span class="close">&times;</span>
        <!-- Modal Content (The Image) -->
        <img class="modal-content" id="img01">
      </p>
      <br>
      <button onclick="togglePopup()" id="report" class="btn btn-danger btn-size">Report</button>
      <button onclick="downloadPDF()" id="download" class="btn btn-info btn-size">Download</button>
      <form action="{{ url_for('result') }}" method="POST" class="btn-size">
        <button name="url" class="btn btn-warning" value="{{ data0 }}">Rescan</button>
      </form>
    </div>

    <!-- right Column -->
    <div class="column right">
      <h4>Submitted URL</h4>
      <p class="url-link"> {{ data0 }} </p>
      <hr>
      <h4>Submitted On</h4>
      <p class="url-link"> {{ data1 }} </p>
      <hr>
      <h4>Existing Web Result</h4>
      <p>VirusTotal</p>
      <p>URLScan.io</p>
      <p>Sucuri</p>
    </div>

    <div class="column left-sum">
      <h4 style="margin-bottom: 1rem;">Result Summary</h4>

      <div class="grid-container">
        <div>URL Status</div>
        {% if data3 == 'benign'%}
        <div style="color: green;"><b>Secure</b></div>
        {% else %}
        <div style="color: red;"><b>Malicious</b></div>
        {% endif %}

        <div>Main Domain</div>
        <div>{{ data4 }}</div>
        <div>Status Code</div>
        <div>{{ data5 }}</div>
        <div>Content Size</div>
        <div>{{ data6 }} bytes</div>
      </div>
    </div>

    <div class="column right-sum">
      <div class="grid-container">
        <div>IP Address</div>
        <div>{{ data7 }}</div>
        <div>Redirects</div>
        <div>{{ data8 }}</div>
        <div>Date Created</div>
        <div>{{ data9 }}</div>
        <div>Country</div>
        <div>{{ data10 }}</div>
      </div>




    </div>
  </div>



  <script>

    var modal = document.getElementById("myModal");
    var img = document.getElementById("webImage");
    var modalImg = document.getElementById("img01");
    var captionText = document.getElementById("caption");
    img.onclick = function () {
      modal.style.display = "block";
      modalImg.src = this.src;
      captionText.innerHTML = this.alt;
    }

    var span = document.getElementsByClassName("close")[0];
    span.onclick = function () {
      modal.style.display = "none";
    }
  </script>

  <script>
    function downloadPDF() {
      var element = document.getElementById("result-sum-page");
      html2pdf(element, {
        margin: 15,
        filename: 'download.pdf',
        image: {
          type: 'jpg',
          quality: 0.98
        },
        html2canvas: {
          scale: 2,
          logging: true,
          dpi: 192,
          letterRendering: true
        },
        jsPDF: {
          unit: 'mm',
          format: 'a4',
          orientation: 'portrait'
        }
      });
    }
  </script>

  <script>
    function togglePopup() {
      document.getElementById("popup-1").classList.toggle("active");
    }
  </script>

  {% endblock %}